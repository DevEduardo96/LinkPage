<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Painel Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
    />
  </head>
  <body class="bg-gray-100 font-sans">
    <div class="max-w-2xl mx-auto py-10 px-4">
      <h1 class="text-2xl font-bold mb-6 text-center">Painel Administrativo</h1>

      <!-- Avatar -->
      <div class="mb-6">
        <label class="block font-semibold mb-2">Avatar:</label>
        <div class="flex items-center space-x-4">
          <img
            id="preview-avatar"
            src="https://via.placeholder.com/80"
            alt="Avatar atual"
            class="w-20 h-20 rounded-full object-cover border"
          />
          <input
            type="file"
            accept="image/*"
            class="block text-sm"
            onchange="previewImage(event)"
          />
        </div>
      </div>

      <!-- Nome -->
      <div class="mb-6">
        <label for="nome" class="block font-semibold mb-2"
          >Nome de usuário:</label
        >
        <input
          type="text"
          id="nome"
          class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400"
          value="@Eduardo"
        />
      </div>

      <!-- Links -->
      <div class="mb-6">
        <label class="block font-semibold mb-2">Links:</label>
        <div id="links-container" class="space-y-4"></div>
        <button
          type="button"
          onclick="addLink()"
          class="mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
        >
          + Adicionar Link
        </button>
      </div>

      <!-- Botão de salvar -->
      <div class="text-center">
        <button
          type="button"
          class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-md"
        >
          Salvar Alterações
        </button>
      </div>
    </div>

    <script>
      const API_URL =
        "https://script.google.com/macros/s/AKfycbzGMPFtDatAfZHco6B8cwzd9OPVkWMisBv7VUo-MNe14fFx9mVRC-Bwhwq28uj4lax4/exec";

      async function carregarDados() {
        try {
          const res = await fetch(API_URL);
          const dados = await res.json();

          if (dados.length === 0) return;

          const info = dados.find((d) => d.avatarUrl || d.username);
          if (info) {
            document.getElementById("preview-avatar").src =
              info.avatarUrl || "https://via.placeholder.com/80";
            document.getElementById("nome").value = info.username || "";
          }

          const container = document.getElementById("links-container");
          container.innerHTML = "";

          dados.forEach((item) => {
            if (!item.linkTitle && !item.linkUrl) return;

            const div = document.createElement("div");
            div.className = "flex items-center space-x-2 mt-2";
            div.innerHTML = `
              <input type="text" placeholder="Título do link" class="flex-1 px-3 py-2 border rounded" value="${
                item.linkTitle || ""
              }" />
              <input type="url" placeholder="URL" class="flex-1 px-3 py-2 border rounded" value="${
                item.linkUrl || ""
              }" />
              <select class="px-2 py-2 border rounded">
                <option value="bi-youtube" ${
                  item.linkIcon === "bi-youtube" ? "selected" : ""
                }>🎥</option>
                <option value="bi-instagram" ${
                  item.linkIcon === "bi-instagram" ? "selected" : ""
                }>📷</option>
                <option value="bi-code-slash" ${
                  item.linkIcon === "bi-code-slash" ? "selected" : ""
                }>💻</option>
                <option value="bi-facebook" ${
                  item.linkIcon === "bi-facebook" ? "selected" : ""
                }>📘</option>
                <option value="bi-github" ${
                  item.linkIcon === "bi-github" ? "selected" : ""
                }>🐙</option>
                <option value="bi-envelope-fill" ${
                  item.linkIcon === "bi-envelope-fill" ? "selected" : ""
                }>✉️</option>
              </select>
              <button onclick="removeLink(this)" class="text-red-600 hover:text-red-800">
                <i class="bi bi-x-circle-fill text-xl"></i>
              </button>
            `;
            container.appendChild(div);
          });
        } catch (error) {
          console.error("Erro ao carregar dados:", error);
        }
      }

      async function salvarDados() {
        const avatarUrl = document.getElementById("preview-avatar").src;
        const username = document.getElementById("nome").value;
        const container = document.getElementById("links-container");
        const divs = container.children;

        const dadosParaSalvar = [];

        // Primeiro objeto: avatar e nome de usuário
        dadosParaSalvar.push({
          avatarUrl,
          username,
          linkTitle: "",
          linkUrl: "",
          linkIcon: "",
        });

        // Demais objetos: links
        Array.from(divs).forEach((div) => {
          const inputs = div.querySelectorAll("input");
          const select = div.querySelector("select");
          dadosParaSalvar.push({
            avatarUrl: "",
            username: "",
            linkTitle: inputs[0]?.value || "",
            linkUrl: inputs[1]?.value || "",
            linkIcon: select?.value || "",
          });
        });

        try {
          const res = await fetch(API_URL, {
            method: "POST",
            body: JSON.stringify(dadosParaSalvar),
            headers: {
              "Content-Type": "application/json",
            },
          });
          const json = await res.json();
          alert(
            json.status === "success" ? "Salvo com sucesso!" : "Erro ao salvar"
          );
        } catch (error) {
          console.error("Erro ao salvar dados:", error);
          alert("Erro ao salvar dados.");
        }
      }

      function addLink() {
        const container = document.getElementById("links-container");
        const div = document.createElement("div");
        div.className = "flex items-center space-x-2 mt-2";
        div.innerHTML = `
          <input type="text" placeholder="Título do link" class="flex-1 px-3 py-2 border rounded" />
          <input type="url" placeholder="URL" class="flex-1 px-3 py-2 border rounded" />
          <select class="px-2 py-2 border rounded">
            <option value="bi-youtube">🎥</option>
            <option value="bi-instagram">📷</option>
            <option value="bi-code-slash">💻</option>
            <option value="bi-facebook">📘</option>
            <option value="bi-github">🐙</option>
            <option value="bi-envelope-fill">✉️</option>
          </select>
          <button onclick="removeLink(this)" class="text-red-600 hover:text-red-800">
            <i class="bi bi-x-circle-fill text-xl"></i>
          </button>
        `;
        container.appendChild(div);
      }

      function removeLink(button) {
        button.parentElement.remove();
      }

      function previewImage(event) {
        const reader = new FileReader();
        reader.onload = function () {
          const output = document.getElementById("preview-avatar");
          output.src = reader.result;
        };
        reader.readAsDataURL(event.target.files[0]);
      }

      // Inicialização
      window.onload = carregarDados;
      document.querySelector("button.bg-green-600").onclick = salvarDados;
    </script>
  </body>
</html>
